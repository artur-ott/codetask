<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../ace-import/ace-import.html">
<link rel="import" href="../ace-static-import/ace-static-import.html">

<dom-module id="koan-task.html">
	<!--<template>
		<div id="koan1">
			<div class="line">var x = 1</div>
			<div class="line">var y = 5</div>
			<div class="line">y should be (</div><span contenteditable="true" class="solution" ></span><div class="line">)</div>
			<div class="line">oderso</div><span></span>
		</div>
	</template>-->

	<style>
		.line {
				display: inline-block;
				margin-top: 0px;
				margin-bottom: 0px;
		}
		.solution {
			display: inline-block;
			width: auto !important;
			height: 20px;
			min-width: 30px;
			max-width: 50%;
			padding-right: 5px;
			padding-left: 5px;
			text-align: center;
			vertical-align: middle;
			color: green;
			border-bottom: 1px solid;
			outline: none;
			outline-style: none;
			-moz-outline-style:none;
		}
	</style>

	<script>
		Polymer({
			is: "koan-task",
			properties: {
				koanCode: String,
				aceTheme: String,
		    	solutionsUrl: String
		    },
			ready: function() {
				if (!this.id)
					console.log("koan cant initialize without id")
				else
					this.initKoan();
			},
			initKoan: function() {
				var div = document.createElement("DIV");
				div.id = this.id + "-code";
				this.appendChild(div);

				var highlight = ace.require("ace/ext/static_highlight");
				var opts = {
					mode: "ace/mode/lua",
					theme: this.aceTheme,
					firstLineNumber: 0,
					showGutter: false,
					trim: true
				};

				this.koanCode.split("\n").forEach(function(line, i) {
					line.split("__").forEach(function(part, j) {
						if (j != 0) {
							var solutionDiv = document.createElement("SPAN");
							solutionDiv.setAttribute("contenteditable", true);
							solutionDiv.classList.add("solution");
							div.appendChild(solutionDiv);

							opts.showGutter = false;
						} else {
							opts.showGutter = true;
							opts.firstLineNumber = i + 1;
						}

						var lineDiv = document.createElement("DIV");
						lineDiv.textContent = part;
						lineDiv.classList.add("line");
						div.appendChild(lineDiv);
						highlight(lineDiv, opts);
					});
					var br = document.createElement("BR");
					div.appendChild(br);
				});
				opts.showGutter = false;
				var lineDiv = document.createElement("DIV");
				lineDiv.textContent = " ";
				lineDiv.classList.add("line");
				div.appendChild(lineDiv);
				highlight(lineDiv, opts);
				highlight(div, opts);
			}
		});
	</script>
</dom-module>